<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Rigid Body Transform Prototype</title>
  <style>
    body { margin: 0; padding-left: 2rem; padding-right: 2rem; font-family: monospace; }
    #ui {
      position: absolute; top: 10px; left: 10px;
      background: rgba(255,255,255,0.9); padding: 10px;
      border-radius: 8px; font-size: 14px;
    }
    input { width: 80px; }
    pre { font-size: 12px; }
    .viz { width: 400px; height: 300px; border: 1px solid #ccc; margin: 20px 0; }

    .container-input {
        display: flex;
        flex-direction: row;
        align-items: center;
    }

    .container-input > input {
        margin-right: 1rem;
    }

    .controls {
        display: flex;
        flex-direction: row;
    }
  </style>
</head>
<body>
<div id="ui">
  <h1>Rigid Body Transforms</h1>
  <p>
    A rigid body transformation is a linear 3D transformation consisting of:
    <ul>
        <li>A translation (a <b>change in position</b>)</li>
        <li>A rotation (a <b>change in orientation</b>)</li>
    </ul>

    Note that a rigid body transformation can not stretch, bend nor flip an object. It is most useful for 
    describing relative locations and poses.
  </p>

  <p>
    Describing a rigid body transformation can thus be done by using 6 numbers:
    <ul>
        <li>Change in <b>x</b></li>
        <li>Change in <b>y</b></li>
        <li>Change in <b>z</b></li>
        <li>Rotation around x</li>
        <li>Rotation around y</li>
        <li>Rotation around z</li>
    </ul>

    <!-- TODO: SO(3) mention -->
    <!-- TODO: footnote about body frame conventions -->

    This way of describing rotations is called <i>Euler angles</i>, and is the method used in tools like <a href="https://wiki.ros.org/tf2">tf2</a>.

    Euler angles are simple to understand and visualize, but suffer from some problems that make them sub optimal to use in computations. Internally,
    TF2 and other software therefore typically use <a href="https://en.wikipedia.org/wiki/Quaternion">quaternions</a>. But you don't have to worry too 
    much about that (yet).
  </p>

  <h3>Conventions</h3>
  <p>
  In this course we use some conventions. I've tried to align them with the conventions used in ROS2.
  <ul>
      <li>The first axis (x-axis) is colored <span style="color: red"><b>red</b></span></li>
      <li>The second axis (y-axis) is colored <span style="color: #08e700"><b>green</b></span></li>
      <li>The third axis (z-axis) is colored <span style="color: blue"><b>blue</b></span></li>
      <li>All translations <b>and rotations</b> are described in the <b>parent frame</b>, i.e. the frame we transform <i>from</i>. 
          This is called extrinsic rotations or Euler 'ZYX' order. 
          Read more <a href="https://mecademic.com/insights/academic-tutorials/space-orientation-euler-angles/">here</a>.</li>
      <li>Rotation around the (parent's) x-axis is referred to as <b>roll</b></li>
      <li>Rotation around the (parent's) y-axis is referred to as <b>pitch</b></li>
      <li>Rotation around the (parent's) z-axis is referred to as <b>yaw</b></li>
  </ul>
  </p>

  <p>
    Before we continue, you can get a feeling for transformations in the interactive visualization below.
  </p>

  <div>
      <div id="viz1" class="viz"></div>
      <pre class="ros2cmd">ros2 run tf2_ros static_transform_publisher --frame-id parent --child-frame-id child</pre>
      <div class="controls">
          <div class="container-input">
              x: <input type="range" class="tx" min="-5" max="5" step="0.1" value="0">
          </div>
          <div class="container-input">
              y: <input type="range" class="ty" min="-5" max="5" step="0.1" value="0">
          </div>
          <div class="container-input">
              z: <input type="range" class="tz" min="-5" max="5" step="0.1" value="0">
          </div>
          <div class="container-input">
              roll: <input type="range" class="rx" min="0" max="360" step="1" value="0">
          </div>
          <div class="container-input">
              pitch: <input type="range" class="ry" min="0" max="360" step="1" value="0">
          </div>
          <div class="container-input">
              yaw: <input type="range" class="rz" min="0" max="360" step="1" value="0">
          </div>
          <div class="container-input">
              <input type="button" class="reset" value="reset"></input>
          </div>
      </div>
      <pre class="matrix"></pre>
  </div>

  <h2>Tasks</h2>
  <p>
    What follows are some tasks I have prepared to force you to become familiar with using transforms.
  </p>

  <h3>Task 1 - Static translation</h3>

  <p>
    We have arrived at the testing site and placed our Ground Control Station. The drone will launch from a launch pad placed on the runway.
    We are going to perform some measurements from the drone and the GCS simultaneously, so it would be helpful to be able to convert coordinates relative 
    to the drone to coordinates relative to the GCS. When the drone is started, it places its origin on the launch pad, and coordinates measured from the 
    drone will be relative to the launch pad.
  </p>

  <p>
  We have estimated the launch pad to be <b>5m</b> in the x-direction, <b>2m</b> in the y-direction and <b>-1m</b> in the z-direction relative to the GCS.
  </p>

  <p>
  Please provide the transformation <b>gcs -> launch_pad</b>.
  </p>
  <div>
      <div id="viz2" class="viz"></div>
      <pre class="ros2cmd">ros2 run tf2_ros static_transform_publisher --frame-id gcs --child-frame-id launch_pad</pre>
      <div class="controls">
          <div class="container-input">
              x: <input type="number" class="tx" value="0">
          </div>
          <div class="container-input">
              y: <input type="number" class="ty" value="0">
          </div>
          <div class="container-input">
              z: <input type="number" class="tz" value="0">
          </div>
          <div class="container-input">
              <input type="hidden" class="rx" value="0">
          </div>
          <div class="container-input">
              <input type="hidden" class="ry" value="0">
          </div>
          <div class="container-input">
              <input type="hidden" class="rz" value="0">
          </div>
          <div class="container-input">
              <input type="button" class="reset" value="reset"></input>
          </div>

      </div>
      <br>
      <div class="status" style="color: #08e700"></div>
  </div>


  <br>
  <br>
  <br>
  <br>
  <br>
</div>

<script type="importmap">
{
  "imports": {
    "three": "https://cdn.jsdelivr.net/npm/three@0.179.1/build/three.module.js",
    "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.179.1/examples/jsm/"
  }
}
</script>
<script type="module" src="main.js"></script>
</body>
</html>
